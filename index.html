<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAS Sudhanshu Patel | Professional Testing Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 1);
        }

        .timer-display {
            font-variant-numeric: tabular-nums;
        }

        #exam-container {
            transition: all 0.3s ease;
        }

        #pdf-viewer {
            height: calc(100vh - 280px);
            min-height: 500px;
        }

        /* Fullscreen styles */
        #exam-container:fullscreen {
            padding: 30px;
            background-color: #0f172a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #exam-container:fullscreen #pdf-viewer {
            height: calc(100vh - 120px);
            border-radius: 1rem;
        }

        #exam-container:fullscreen .header-content {
            color: white;
            margin-bottom: 1.5rem;
        }

        #exam-container:fullscreen h2 {
            color: white;
        }

        #exam-container:fullscreen .timer-box {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 py-4 px-6 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-2 rounded-lg shadow-md shadow-indigo-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                </div>
                <h1 class="text-xl font-bold text-slate-900 tracking-tight">IAS Sudhanshu Patel</h1>
            </div>
            
            <div id="welcome-text" class="text-xs font-semibold text-slate-400 uppercase tracking-widest hidden md:block">
                Civil Services Prep Portal
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full p-6">
        
        <!-- Setup Section -->
        <section id="setup-section" class="max-w-2xl mx-auto mt-12 animate-in fade-in slide-in-from-bottom-4 duration-700">
            <div class="glass-card rounded-3xl p-10 shadow-2xl shadow-slate-200/60 border-2 border-white/50">
                <div class="mb-8">
                    <h2 class="text-3xl font-extrabold text-slate-900 mb-2">Setup Exam Session</h2>
                    <p class="text-slate-500">Welcome to the IAS Sudhanshu Patel exam simulation vault.</p>
                </div>

                <div class="space-y-6">
                    <!-- File Upload -->
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">Upload Question Paper</label>
                        <div id="drop-zone" class="border-2 border-dashed border-slate-200 rounded-2xl p-10 text-center hover:border-indigo-400 hover:bg-indigo-50/30 transition-all cursor-pointer group">
                            <input type="file" id="file-input" class="hidden" accept=".pdf,.doc,.docx">
                            <div class="text-slate-400 group-hover:text-indigo-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <p id="file-name" class="font-semibold text-lg text-slate-600">Click to select UPSC paper</p>
                                <p class="text-sm mt-1">PDF format highly recommended</p>
                            </div>
                        </div>
                    </div>

                    <!-- Timer Config -->
                    <div class="grid grid-cols-2 gap-6">
                        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <label class="block text-xs font-black uppercase text-slate-400 mb-2 tracking-widest">Duration (Hours)</label>
                            <input type="number" id="input-hours" min="0" max="24" value="2" class="w-full bg-transparent text-2xl font-bold focus:outline-none">
                        </div>
                        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <label class="block text-xs font-black uppercase text-slate-400 mb-2 tracking-widest">Duration (Minutes)</label>
                            <input type="number" id="input-minutes" min="0" max="59" value="0" class="w-full bg-transparent text-2xl font-bold focus:outline-none">
                        </div>
                    </div>

                    <button id="start-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-5 rounded-2xl shadow-xl shadow-indigo-200 transition-all transform active:scale-[0.98] flex items-center justify-center gap-3 text-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Begin Examination
                    </button>
                </div>
            </div>
        </section>

        <!-- Exam Section -->
        <section id="exam-section" class="hidden h-full">
            <div id="exam-container" class="flex flex-col gap-4 h-full">
                <!-- Session Header -->
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 header-content">
                    <div class="flex-1">
                        <h2 id="current-paper-title" class="text-2xl font-black text-slate-900 truncate">Question Paper</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            <p class="text-slate-500 text-sm font-medium">Session Active â€¢ IAS Sudhanshu Patel Portal</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 flex-wrap">
                        <div id="active-timer-pill" class="flex items-center gap-3 bg-slate-900 px-4 py-2 rounded-xl border border-slate-700 shadow-lg timer-box">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Remaining</span>
                            <span id="display-timer" class="timer-display text-lg font-mono font-bold text-indigo-400">00:00:00</span>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="fullscreen-btn" class="flex items-center gap-2 bg-white border border-slate-200 px-4 py-2 rounded-xl font-bold hover:bg-slate-50 transition-all shadow-sm text-slate-700">
                                <svg id="fs-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                                </svg>
                                <span id="fs-text" class="text-sm">Full Screen</span>
                            </button>
                            
                            <button id="finish-btn" class="bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-xl font-bold transition-all shadow-lg shadow-red-100 text-sm">
                                End Test
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Paper Container -->
                <div class="glass-card rounded-2xl overflow-hidden shadow-2xl border-2 border-indigo-100/50 bg-slate-200 flex-grow">
                    <iframe id="pdf-viewer" class="w-full" src="" frameborder="0"></iframe>
                </div>
            </div>
        </section>

        <!-- Result Section -->
        <section id="result-section" class="hidden max-w-lg mx-auto mt-20 text-center animate-in zoom-in duration-500">
            <div class="bg-white p-12 rounded-[2.5rem] shadow-2xl border border-slate-100 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-amber-500"></div>
                <div class="w-24 h-24 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-8">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <h2 class="text-4xl font-black text-slate-900 mb-3">Time Expired</h2>
                <p class="text-slate-500 mb-10 text-lg leading-relaxed">The test session has concluded. Access to the question paper is now locked.</p>
                <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-slate-800 transition-all shadow-xl shadow-slate-200">
                    Prepare New Session
                </button>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="mt-auto py-8 text-center border-t border-slate-100 bg-white">
        <p class="text-slate-400 text-sm font-medium">
            Copyright &copy; <span id="current-year"></span> by <span class="text-slate-600 font-bold">IAS Sudhanshu Patel</span>. All Rights Reserved.
        </p>
    </footer>

    <!-- Confirm Modal Container (Fixed) -->
    <div id="modal-container" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-md p-4">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-slate-100">
            <h3 id="modal-title" class="text-2xl font-bold text-slate-900 mb-2">Notice</h3>
            <p id="modal-message" class="text-slate-500 mb-8 leading-relaxed"></p>
            <div id="modal-actions" class="flex flex-col gap-2">
                <button id="modal-close" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 transition-colors">Understood</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();

        let timeLeft = 0;
        let timerInterval = null;
        let uploadedFileUrl = null;

        const setupSection = document.getElementById('setup-section');
        const examSection = document.getElementById('exam-section');
        const examContainer = document.getElementById('exam-container');
        const resultSection = document.getElementById('result-section');
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileNameDisplay = document.getElementById('file-name');
        const startBtn = document.getElementById('start-btn');
        const pdfViewer = document.getElementById('pdf-viewer');
        const displayTimer = document.getElementById('display-timer');
        const activeTimerPill = document.getElementById('active-timer-pill');
        const finishBtn = document.getElementById('finish-btn');
        const paperTitle = document.getElementById('current-paper-title');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const fsText = document.getElementById('fs-text');

        const modalContainer = document.getElementById('modal-container');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalClose = document.getElementById('modal-close');
        const modalActions = document.getElementById('modal-actions');

        function showAlert(title, msg) {
            modalTitle.textContent = title;
            modalMessage.textContent = msg;
            modalActions.innerHTML = `<button id="modal-ok" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 transition-colors">Understood</button>`;
            document.getElementById('modal-ok').onclick = () => modalContainer.classList.add('hidden');
            modalContainer.classList.remove('hidden');
        }

        function endSession() {
            clearInterval(timerInterval);
            if (document.fullscreenElement) document.exitFullscreen().catch(() => {});
            examSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            pdfViewer.src = ""; 
            if (uploadedFileUrl) URL.revokeObjectURL(uploadedFileUrl);
            uploadedFileUrl = null;
        }

        fullscreenBtn.onclick = () => {
            if (!document.fullscreenElement) {
                examContainer.requestFullscreen().catch(err => {
                    showAlert("Fullscreen Error", `Could not enable full screen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        };

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                fsText.textContent = "Exit Full Screen";
            } else {
                fsText.textContent = "Full Screen";
            }
        });

        document.addEventListener('keydown', (e) => {
            if (!examSection.classList.contains('hidden') && e.key.toLowerCase() === 'f') {
                fullscreenBtn.click();
            }
        });

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                fileNameDisplay.textContent = file.name;
                fileNameDisplay.classList.add('text-indigo-600');
                paperTitle.textContent = file.name;
                if (uploadedFileUrl) URL.revokeObjectURL(uploadedFileUrl);
                uploadedFileUrl = URL.createObjectURL(file);
            }
        };

        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-indigo-400', 'bg-indigo-50/50'); };
        dropZone.ondragleave = () => { dropZone.classList.remove('border-indigo-400', 'bg-indigo-50/50'); };
        dropZone.ondrop = (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-indigo-400', 'bg-indigo-50/50');
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                fileInput.onchange({ target: { files: e.dataTransfer.files } });
            }
        };

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return [h, m, s].map(v => v < 10 ? "0" + v : v).join(":");
        }

        startBtn.onclick = () => {
            const hours = parseInt(document.getElementById('input-hours').value) || 0;
            const minutes = parseInt(document.getElementById('input-minutes').value) || 0;
            
            if (!uploadedFileUrl) {
                showAlert("Missing File", "Please upload a question paper to begin.");
                return;
            }
            if (hours === 0 && minutes === 0) {
                showAlert("Invalid Time", "Please set a duration for the exam.");
                return;
            }

            timeLeft = (hours * 3600) + (minutes * 60);
            setupSection.classList.add('hidden');
            examSection.classList.remove('hidden');
            pdfViewer.src = uploadedFileUrl;

            updateDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
                if (timeLeft <= 0) endSession();
            }, 1000);
        };

        function updateDisplay() {
            displayTimer.textContent = formatTime(timeLeft);
            if (timeLeft < 300) {
                displayTimer.classList.replace('text-indigo-400', 'text-red-400');
                activeTimerPill.classList.add('ring-2', 'ring-red-500/50', 'animate-pulse');
            } else {
                displayTimer.classList.remove('text-red-400');
                displayTimer.classList.add('text-indigo-400');
                activeTimerPill.classList.remove('ring-2', 'ring-red-500/50', 'animate-pulse');
            }
        }

        finishBtn.onclick = () => {
            modalTitle.textContent = "End Session?";
            modalMessage.textContent = "Are you sure? You won't be able to see the paper again once you finish.";
            modalActions.innerHTML = `
                <div class="grid grid-cols-2 gap-3 w-full">
                    <button id="modal-cancel" class="py-3 bg-slate-100 rounded-xl font-bold text-slate-700">Cancel</button>
                    <button id="modal-confirm" class="py-3 bg-red-500 text-white rounded-xl font-bold shadow-lg shadow-red-200">End Test</button>
                </div>
            `;
            
            modalContainer.classList.remove('hidden');
            
            document.getElementById('modal-cancel').onclick = () => modalContainer.classList.add('hidden');
            document.getElementById('modal-confirm').onclick = () => {
                modalContainer.classList.add('hidden');
                endSession();
            };
        };

        window.onbeforeunload = function() {
            if (timerInterval) return "Exam in progress.";
        };
    </script>
</body>
</html>